<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content=" liusha" />


    
    


<meta name="description" content="人工智能、机器学习、深度学习、数据挖掘、深度聚类">
<meta property="og:type" content="website">
<meta property="og:title" content="流沙">
<meta property="og:url" content="https://jpccc.github.io/index.html">
<meta property="og:site_name" content="流沙">
<meta property="og:description" content="人工智能、机器学习、深度学习、数据挖掘、深度聚类">
<meta property="og:locale">
<meta property="article:author" content=" liusha">
<meta property="article:tag" content="人工智能、机器学习、深度学习、数据挖掘、深度聚类">
<meta name="twitter:card" content="summary">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="流沙" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">



<link rel="stylesheet" href="/css/style.css">



    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>流沙</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/"></a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="https://jpccc.github.io/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/%E9%9A%8F%E7%AC%94">随笔</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:jiangpc21@mails.glu.edu.cn" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa QQ" href="/1778013127" title="QQ"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/deepLearning/" rel="tag">deepLearning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/" rel="tag">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pytorch/" rel="tag">pytorch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag">深度学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0/" rel="tag">统计学习</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">机器学习</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页"></a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="https://jpccc.github.io/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/%E9%9A%8F%E7%AC%94">随笔</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:jiangpc21@mails.glu.edu.cn" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa QQ" target="_blank" href="/1778013127" title="QQ"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-图像的操作" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/04/11/%E5%9B%BE%E5%83%8F%E7%9A%84%E6%93%8D%E4%BD%9C/" class="article-date">
      <time datetime="2022-04-11T02:32:32.733Z" itemprop="datePublished">2022-04-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="PIL"><a href="#PIL" class="headerlink" title="PIL"></a>PIL</h2><blockquote>
<p>  PIL，全称 Python Imaging Library，是一个功能非常强大而且简单易用的图像处理库,已经是Python平台事实上的图像处理标准库了。PIL功能非常强大，但API却非常简单易用。但是，由于 PIL 仅支持到Python 2.7，加上年久失修，于是一群志愿者在 PIL 的基础上创建了兼容 Python 3 的版本，名字叫 Pillow ，我们可以通过安装 Pillow 来使用 PIL。</p>
</blockquote>
<h3 id="1-pip-安装-pillow"><a href="#1-pip-安装-pillow" class="headerlink" title="1. pip 安装 pillow"></a>1. pip 安装 pillow</h3><p>在 Ubuntu 下通过一个简单的命令<code>pip3 install pillow</code>即可成功安装库。</p>
<p>如果遇到<code>Permission denied</code>安装失败，请加上<code>sudo</code>重试。</p>
<h3 id="2-打开、保存、显示图片"><a href="#2-打开、保存、显示图片" class="headerlink" title="2. 打开、保存、显示图片"></a>2. 打开、保存、显示图片</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">image = Image.<span class="built_in">open</span>(<span class="string">&#x27;cat.jpg&#x27;</span>)</span><br><span class="line">image.show()</span><br><span class="line">image.save(<span class="string">&#x27;1.jpg&#x27;</span>,<span class="string">&#x27;jpeg&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(image.mode, image.size, image.<span class="built_in">format</span>)</span><br><span class="line"><span class="comment"># RGB (481, 321) JPEG</span></span><br></pre></td></tr></table></figure>

<ul>
<li>  mode 属性为图片的模式，RGB 代表彩色图像，L 代表光照图像也即灰度图像等</li>
<li>  size 属性为图片的大小(宽度，长度)</li>
<li>  format 属性为图片的格式，如常见的 PNG、JPEG 等</li>
</ul>
<h3 id="3-转换图片模式"><a href="#3-转换图片模式" class="headerlink" title="3. 转换图片模式"></a>3. 转换图片模式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">image.show()</span><br><span class="line">grey_image = image.convert(<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">grey_image.show()</span><br></pre></td></tr></table></figure>



<p><img src="E:\笔记\markdown\reference\picture\v2-fa0ae3e48ef7a9645c252b49c16fce06_720w.jpg" alt="img"></p>
<p><img src="E:\笔记\markdown\reference\picture\v2-0e23c82abff1c3673d55358c7e6f1155_720w.jpg" alt="img"></p>
<ul>
<li>  任何支持的图片模式都可以直接转为彩色模式或者灰度模式，但是，若是想转化为其他模式，则需要借助一个中间模式（通常是彩色）来进行过转</li>
</ul>
<h3 id="4-通道分离合并"><a href="#4-通道分离合并" class="headerlink" title="4. 通道分离合并"></a>4. 通道分离合并</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r, g, b = image.split()</span><br><span class="line">im = Image.merge(<span class="string">&#x27;RGB&#x27;</span>, (b, g, r))</span><br></pre></td></tr></table></figure>

<ul>
<li>  彩色图像可以分离出 R、G、B 通道，但若是灰度图像，则返回灰度图像本身。然后，可以将 R、G、B 通道按照一定的顺序再合并成彩色图像。</li>
</ul>
<h3 id="5-图片裁剪、旋转和改变大小"><a href="#5-图片裁剪、旋转和改变大小" class="headerlink" title="5. 图片裁剪、旋转和改变大小"></a>5. 图片裁剪、旋转和改变大小</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">box = (<span class="number">100</span>, <span class="number">100</span>, <span class="number">300</span>, <span class="number">300</span>)</span><br><span class="line">region = image.crop(box)</span><br><span class="line">region = region.transpose(Image.ROTATE_180)</span><br><span class="line">image.paste(region, box)</span><br><span class="line">image.show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageFilter</span><br><span class="line"><span class="comment"># 打开一个jpg图像文件，注意是当前路径:</span></span><br><span class="line">im = Image.<span class="built_in">open</span>(<span class="string">&#x27;test.jpg&#x27;</span>)</span><br><span class="line"><span class="comment"># 应用模糊滤镜:</span></span><br><span class="line">im2 = im.<span class="built_in">filter</span>(ImageFilter.BLUR)</span><br></pre></td></tr></table></figure>

<p><img src="E:\笔记\markdown\reference\picture\v2-6eb679436bfcefcf51d57c95d5e1ef10_720w.jpg" alt="img"></p>
<ul>
<li>  通过定义一个 4 元组，依次为左上角 X 坐标、Y 坐标，右下角 X 坐标、Y 坐标，可以対原图片的某一区域进行裁剪，然后进行一定处理后可以在原位置粘贴回去。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">im = image.resize((300, 300))</span><br><span class="line">im = image.rotate(45)  # 逆时针旋转 45 度</span><br><span class="line">im = image.transpose(Image.FLIP_LEFT_RIGHT) # 左右翻转</span><br><span class="line">im = im.transpose(Image.FLIP_TOP_BOTTOM)# 上下翻转</span><br><span class="line"># 缩放到50%:</span><br><span class="line">im.thumbnail((w//2, h//2))</span><br></pre></td></tr></table></figure>

<h3 id="6-像素值操作"><a href="#6-像素值操作" class="headerlink" title="6. 像素值操作"></a>6. 像素值操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">out = image.point(<span class="keyword">lambda</span> i: i * <span class="number">1.2</span>) <span class="comment"># 对每个像素值乘以 1.2</span></span><br><span class="line">source = image.split()</span><br><span class="line">out = source[<span class="number">0</span>].point(<span class="keyword">lambda</span> i: i &gt; <span class="number">128</span> <span class="keyword">and</span> <span class="number">255</span>) <span class="comment"># 对 R 通道进行二值化</span></span><br></pre></td></tr></table></figure>



<p><img src="E:\笔记\markdown\reference\picture\v2-8317adc4f04515dec04330c85bd332c7_720w.jpg" alt="img"></p>
<ul>
<li>  i &gt; 128 and 255，当 i &lt;= 128 时，返回 False 也即 0,；反之返回 255 。</li>
</ul>
<h3 id="7-和-Numpy-数组之间的转化"><a href="#7-和-Numpy-数组之间的转化" class="headerlink" title="7. 和 Numpy 数组之间的转化"></a>7. 和 Numpy 数组之间的转化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">array = np.array(image)</span><br><span class="line"><span class="built_in">print</span>(array.shape) <span class="comment">#(321, 481, 3)</span></span><br><span class="line">image = Image.fromarray(array)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#tesnor 转pil</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">image = x.cpu().clone()</span><br><span class="line">image = image.squeeze(<span class="number">0</span>)  <span class="comment"># 压缩一维</span></span><br><span class="line">image = transforms.ToPILImage()(image)  <span class="comment"># 自动转换为0-255</span></span><br><span class="line"><span class="comment"># image.show()</span></span><br><span class="line">file = <span class="string">&quot;./pic/&quot;</span> + <span class="built_in">str</span>(step) + <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">Image.Image.save(image, file)</span><br></pre></td></tr></table></figure>

<h3 id="8-绘图"><a href="#8-绘图" class="headerlink" title="8.绘图"></a>8.绘图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont, ImageFilter</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机字母:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rndChar</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(random.randint(<span class="number">65</span>, <span class="number">90</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机颜色1:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rndColor</span>():</span></span><br><span class="line">    <span class="keyword">return</span> (random.randint(<span class="number">64</span>, <span class="number">255</span>), random.randint(<span class="number">64</span>, <span class="number">255</span>), random.randint(<span class="number">64</span>, <span class="number">255</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机颜色2:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rndColor2</span>():</span></span><br><span class="line">    <span class="keyword">return</span> (random.randint(<span class="number">32</span>, <span class="number">127</span>), random.randint(<span class="number">32</span>, <span class="number">127</span>), random.randint(<span class="number">32</span>, <span class="number">127</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 240 x 60:</span></span><br><span class="line">width = <span class="number">60</span> * <span class="number">4</span></span><br><span class="line">height = <span class="number">60</span></span><br><span class="line">image = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (width, height), (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line"><span class="comment"># 创建Font对象:</span></span><br><span class="line">font = ImageFont.truetype(<span class="string">&#x27;Arial.ttf&#x27;</span>, <span class="number">36</span>)</span><br><span class="line"><span class="comment"># 创建Draw对象:</span></span><br><span class="line">draw = ImageDraw.Draw(image)</span><br><span class="line"><span class="comment"># 填充每个像素:</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">        draw.point((x, y), fill=rndColor())</span><br><span class="line"><span class="comment"># 输出文字:</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    draw.text((<span class="number">60</span> * t + <span class="number">10</span>, <span class="number">10</span>), rndChar(), font=font, fill=rndColor2())</span><br><span class="line"><span class="comment"># 模糊:</span></span><br><span class="line">image = image.<span class="built_in">filter</span>(ImageFilter.BLUR)</span><br><span class="line">image.save(<span class="string">&#x27;code.jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://pillow.readthedocs.org/">官方文档</a></p>
<h2 id="plt"><a href="#plt" class="headerlink" title="plt"></a>plt</h2><h2 id="opencv"><a href="#opencv" class="headerlink" title="opencv"></a>opencv</h2><p>openCV具体笔记见对应的ipynb文件</p>
<p>注意：</p>
<ol>
<li> ​    opencv的读取格式为：W,H,C，其中C是BGR的，plt等是RGB的。</li>
</ol>
<h2 id="数据增强"><a href="#数据增强" class="headerlink" title="数据增强"></a>数据增强</h2><h3 id="一、-概念"><a href="#一、-概念" class="headerlink" title="一、 概念"></a>一、 概念</h3><p>在图像分类任务中，图像数据的增广是一种常用的<strong>正则化方法</strong>，主要用于增加训练数据集，让数据集尽可能的多样化，使得训练的模型具有更强的<strong>泛化能力</strong>，常用于数据量不足或者模型参数较多的场景。除了 ImageNet 分类任务标准数据增广方法外，还有8种数据增广方式非常常用，这里对其进行简单的介绍和对比，大家也可以将这些增广方法应用到自己的任务中，以获得模型精度的提升。这8种数据增广方式在ImageNet上的精度指标如 <strong>图1</strong> 所示。</p>
<p><img src="https://paddlepedia.readthedocs.io/en/latest/_images/main_image_aug.png" alt="img"></p>
<center>图一 8种数据增广方法</center>

<h3 id="二、常用数据增广方法"><a href="#二、常用数据增广方法" class="headerlink" title="二、常用数据增广方法"></a>二、<a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#id2">常用数据增广方法</a></h3><blockquote>
<p>注：如果没有特殊说明，本章节中所有示例为 ImageNet 分类，并且假设最终输入网络的数据维为：[batch-size, 3, 224, 224]</p>
</blockquote>
<p>在ImageNet 分类任务中，训练阶段的标准数据增广方法为以下几步：</p>
<ol>
<li><p>图像解码：简写为 <code>ImageDecode</code></p>
</li>
<li><p>随机裁剪到长宽均为 224 的图像：简写为 <code>RandCrop</code></p>
</li>
<li><p>水平方向随机翻转：简写为 <code>RandFlip</code></p>
</li>
<li><p>图像数据的归一化：简写为 <code>Normalize</code></p>
</li>
<li><p>图像数据的重排，<code>[224, 224, 3]</code> 变为 <code>[3, 224, 224]</code>：简写为 <code>Transpose</code></p>
</li>
<li><p>多幅图像数据组成 batch 数据，如 <code>batch-size</code> 个 <code>[3, 224, 224]</code> 的图像数据拼组成 <code>[batch-size, 3, 224, 224]</code>：简写为 <code>Batch</code></p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于pytorch框架实现以上基本的图像增广操作</span></span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>相比于上述标准的图像增广方法，研究者也提出了很多改进的图像增广策略，这些策略均是在标准增广方法的不同阶段插入一定的操作，基于这些策略操作所处的不同阶段，我们将其分为了三类：</p>
<ol>
<li><p>对 <code>RandCrop</code> (上述的阶段2)后的 224 的图像进行一些变换: AutoAugment，RandAugment</p>
</li>
<li><p>对<code>Transpose</code> (上述的阶段5)后的 224 的图像进行一些裁剪: CutOut，RandErasing，HideAndSeek，GridMask</p>
</li>
<li><p>对 <code>Batch</code>(上述的阶段6) 后的数据进行混合: Mixup，Cutmix</p>
</li>
</ol>
<p>增广后的可视化效果如 <strong>图2</strong> 所示。</p>
<p><img src="E:\笔记\markdown\reference\picture\image_aug_samples_s.jpg" alt="图2 数据增广后可视化"></p>
<center> 图2 数据增广后可视化</center>

<p>下文将介绍这些策略的原理与使用方法，其中，每种数据增广策略的参考论文与参考开源代码均在下面的介绍中列出。</p>
<p>以 <strong>图3</strong> 为测试图像，第三节将基于测试图像进行变换，并将变换后的效果进行可视化。</p>
<blockquote>
<p>由于<code>RandCrop</code>是随机裁剪，变换前后的图像内容可能会有一定的差别，无法直观地对比变换前后的图像。因此，本节将 <code>RandCrop</code> 替换为 <code>Resize</code>。</p>
</blockquote>
<p><img src="E:\笔记\markdown\reference\picture\test_baseline.jpeg" alt="图3 测试图像"></p>
<center>图3 测试图像</center>

<h3 id="三、图像变换类"><a href="#三、图像变换类" class="headerlink" title="三、图像变换类"></a>三、<a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#id3">图像变换类</a></h3><p>图像变换类指的是对 <code>RandCrop</code> 后的224 的图像进行一些变换，主要包括：</p>
<ul>
<li>AutoAugment[1]</li>
<li>RandAugment[2]</li>
</ul>
<h4 id="3-1-AutoAugment"><a href="#3-1-AutoAugment" class="headerlink" title="3.1 AutoAugment"></a>3.1 <a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#autoaugment">AutoAugment</a></h4><p>论文地址：<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1805.09501v1">https://arxiv.org/abs/1805.09501v1</a></p>
<p>开源代码github地址：<a target="_blank" rel="noopener" href="https://github.com/DeepVoltaire/AutoAugment">https://github.com/DeepVoltaire/AutoAugment</a></p>
<p>不同于常规的人工设计图像增广方式，AutoAugment 是在一系列图像增广子策略的搜索空间中通过搜索算法找到的适合特定数据集的图像增广方案。针对 ImageNet 数据集，最终搜索出来的数据增广方案包含 25 个子策略组合，每个子策略中都包含两种变换，针对每幅图像都随机的挑选一个子策略组合，然后以一定的概率来决定是否执行子策略中的每种变换。</p>
<p>结果如 <strong>图4</strong> 所示。</p>
<p><img src="E:\笔记\markdown\reference\picture\test_autoaugment.jpeg" alt="图4 AutoAugment后图像可视化"></p>
<center>图4 AutoAugment后图像可视化</center>

<h4 id="3-2-RandAugment"><a href="#3-2-RandAugment" class="headerlink" title="3.2 RandAugment"></a>3.2 <a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#randaugment">RandAugment</a></h4><p>论文地址：<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1909.13719.pdf">https://arxiv.org/pdf/1909.13719.pdf</a></p>
<p>开源代码github地址：<a target="_blank" rel="noopener" href="https://github.com/heartInsert/randaugment">https://github.com/heartInsert/randaugment</a></p>
<p><code>AutoAugment</code> 的搜索方法比较暴力，直接在数据集上搜索针对该数据集的最优策略，其计算量很大。在 <code>RandAugment</code> 文章中作者发现，一方面，针对越大的模型，越大的数据集，使用 <code>AutoAugment</code> 方式搜索到的增广方式产生的收益也就越小；另一方面，这种搜索出的最优策略是针对该数据集的，其迁移能力较差，并不太适合迁移到其他数据集上。</p>
<p>在 <code>RandAugment</code> 中，作者提出了一种随机增广的方式，不再像 <code>AutoAugment</code> 中那样使用特定的概率确定是否使用某种子策略，而是所有的子策略都会以同样的概率被选择到，论文中的实验也表明这种数据增广方式即使在大模型的训练中也具有很好的效果。</p>
<p>结果如 <strong>图5</strong> 所示。</p>
<p><img src="E:\笔记\markdown\reference\picture\test_randaugment.jpeg" alt="图5 RandAugment后图像可视化"></p>
<center>图5 RandAugment后图像可视化</center>

<h3 id="四、图像裁剪类"><a href="#四、图像裁剪类" class="headerlink" title="四、图像裁剪类"></a>四、<a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#id4">图像裁剪类</a></h3><p>图像裁剪类主要是对<code>Transpose</code> 后的 224 的图像进行一些裁剪，并将裁剪区域的像素值置为特定的常数（默认为0），主要包括：</p>
<ul>
<li>CutOut[3]</li>
<li>RandErasing[4]</li>
<li>HideAndSeek[5]</li>
<li>GridMask[6]</li>
</ul>
<p>图像裁剪的这些增广并非一定要放在归一化之后，也有不少实现是放在归一化之前的，也就是直接对 uint8 的图像进行操作，两种方式的差别是：如果直接对 uint8 的图像进行操作，那么再经过归一化之后被裁剪的区域将不再是纯黑或纯白（减均值除方差之后像素值不为0）。而对归一后之后的数据进行操作，裁剪的区域会是纯黑或纯白。</p>
<p>上述的裁剪变换思路是相同的，都是为了解决训练出的模型在有遮挡数据上泛化能力较差的问题，不同的是他们的裁剪方式、区域不太一样。</p>
<h4 id="4-1-Cutout"><a href="#4-1-Cutout" class="headerlink" title="4.1 Cutout"></a>4.1 <a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#cutout">Cutout</a></h4><p>论文地址：<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1708.04552">https://arxiv.org/abs/1708.04552</a></p>
<p>开源代码github地址：<a target="_blank" rel="noopener" href="https://github.com/uoguelph-mlrg/Cutout">https://github.com/uoguelph-mlrg/Cutout</a></p>
<p>Cutout 可以理解为 Dropout 的一种扩展操作，不同的是 Dropout 是对图像经过网络后生成的特征进行遮挡，而 Cutout 是直接对输入的图像进行遮挡，相对于Dropout，Cutout 对噪声的鲁棒性更好。作者在论文中也进行了说明，这样做法有以下两点优势：(1) 通过 Cutout 可以模拟真实场景中主体被部分遮挡时的分类场景；(2) 可以促进模型充分利用图像中更多的内容来进行分类，防止网络只关注显著性的图像区域，从而发生过拟合。</p>
<p>结果如 <strong>图6</strong> 所示。</p>
<p><img src="E:\笔记\markdown\reference\picture\test_cutout.jpeg" alt="图6 Cutout后图像可视化"></p>
<center>图6 Cutout后图像可视化</center>

<h4 id="4-2-RandomErasing"><a href="#4-2-RandomErasing" class="headerlink" title="4.2 RandomErasing"></a>4.2 <a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#randomerasing">RandomErasing</a></h4><p>论文地址：<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1708.04896.pdf">https://arxiv.org/pdf/1708.04896.pdf</a></p>
<p>开源代码github地址：<a target="_blank" rel="noopener" href="https://github.com/zhunzhong07/Random-Erasing">https://github.com/zhunzhong07/Random-Erasing</a></p>
<p><code>RandomErasing</code> 与 <code>Cutout</code> 方法类似，同样是为了解决训练出的模型在有遮挡数据上泛化能力较差的问题，作者在论文中也指出，随机裁剪的方式与随机水平翻转具有一定的互补性。作者也在行人再识别（REID）上验证了该方法的有效性。与<code>Cutout</code>不同的是，在<code>RandomErasing</code>中，图片以一定的概率接受该种预处理方法，生成掩码的尺寸大小与长宽比也是根据预设的超参数随机生成。</p>
<p>结果如 <strong>图7</strong> 所示。</p>
<p><img src="E:\笔记\markdown\reference\picture\test_randomerassing.jpeg" alt="图7 RandomErasing后图像可视化"></p>
<center>图7 RandomErasing后图像可视化</center>

<h4 id="4-3-HideAndSeek"><a href="#4-3-HideAndSeek" class="headerlink" title="4.3 HideAndSeek"></a>4.3 <a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#hideandseek">HideAndSeek</a></h4><p>论文地址：<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1811.02545.pdf">https://arxiv.org/pdf/1811.02545.pdf</a></p>
<p>开源代码github地址：<a target="_blank" rel="noopener" href="https://github.com/kkanshul/Hide-and-Seek">https://github.com/kkanshul/Hide-and-Seek</a></p>
<p><code>HideAndSeek</code>论文将图像分为若干块区域(patch)，对于每块区域，都以一定的概率生成掩码，不同区域的掩码含义如 <strong>图8</strong> 所示。</p>
<p><img src="E:\笔记\markdown\reference\picture\hide-and-seek-visual.png" alt="图8 HideAndSeek分块掩码图"></p>
<center>图8 HideAndSeek分块掩码图</center>

<p>结果如 <strong>图9</strong> 所示。</p>
<p><img src="E:\笔记\markdown\reference\picture\test_hideandseek.jpeg" alt="图9 HideAndSeek后图像可视化"></p>
<center>图9 HideAndSeek后图像可视化</center>

<h4 id="4-4-GridMask"><a href="#4-4-GridMask" class="headerlink" title="4.4 GridMask"></a>4.4 <a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#gridmask">GridMask</a></h4><p>论文地址：<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2001.04086">https://arxiv.org/abs/2001.04086</a></p>
<p>开源代码github地址：<a target="_blank" rel="noopener" href="https://github.com/akuxcw/GridMask">https://github.com/akuxcw/GridMask</a></p>
<p>作者在论文中指出，此前存在的基于对图像 crop 的方法存在两个问题，如 <strong>图10</strong> 所示：</p>
<ol>
<li><p>过度删除区域可能造成目标主体大部分甚至全部被删除，或者导致上下文信息的丢失，导致增广后的数据成为噪声数据；</p>
</li>
<li><p>保留过多的区域，对目标主体及上下文基本产生不了什么影响，失去增广的意义。</p>
</li>
</ol>
<p><img src="E:\笔记\markdown\reference\picture\gridmask-0.png" alt="图10 增广后的噪声数据"></p>
<center>图10 增广后的噪声数据</center>

<p>因此如果避免过度删除或过度保留成为需要解决的核心问题。</p>
<p><code>GridMask</code>是通过生成一个与原图分辨率相同的掩码，并将掩码进行随机翻转，与原图相乘，从而得到增广后的图像，通过超参数控制生成的掩码网格的大小。</p>
<p>在训练过程中，有两种以下使用方法：</p>
<ol>
<li>设置一个概率p，从训练开始就对图片以概率p使用<code>GridMask</code>进行增广。</li>
<li>一开始设置增广概率为0，随着迭代轮数增加，对训练图片进行<code>GridMask</code>增广的概率逐渐增大，最后变为p。</li>
</ol>
<p>论文中验证上述第二种方法的训练效果更好一些。</p>
<p>结果如 <strong>图11</strong> 所示。</p>
<p><img src="E:\笔记\markdown\reference\picture\test_gridmask.jpeg" alt="图11 GridMask后图像可视化"></p>
<center>图11 GridMask后图像可视化</center>

<h3 id="五、图像混叠"><a href="#五、图像混叠" class="headerlink" title="五、图像混叠"></a>五、<a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#id5">图像混叠</a></h3><p>图像混叠主要对 <code>Batch</code> 后的数据进行混合，包括：</p>
<ul>
<li>Mixup[7]</li>
<li>Cutmix[8]</li>
</ul>
<p>前文所述的图像变换与图像裁剪都是针对单幅图像进行的操作，而图像混叠是对两幅图像进行融合，生成一幅图像，两种方法的主要区别为混叠的方式不太一样。</p>
<h4 id="5-1-Mixup"><a href="#5-1-Mixup" class="headerlink" title="5.1 Mixup"></a>5.1 <a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#mixup">Mixup</a></h4><p>论文地址：<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1710.09412.pdf">https://arxiv.org/pdf/1710.09412.pdf</a></p>
<p>开源代码github地址：<a target="_blank" rel="noopener" href="https://github.com/facebookresearch/mixup-cifar10">https://github.com/facebookresearch/mixup-cifar10</a></p>
<p>Mixup 是最先提出的图像混叠增广方案，其原理简单、方便实现，不仅在图像分类上，在目标检测上也取得了不错的效果。为了便于实现，通常只对一个 batch 内的数据进行混叠，在 <code>Cutmix</code> 中也是如此。</p>
<p>如下是 <code>imaug</code> 中的实现，需要指出的是，下述实现会出现对同一幅进行相加的情况，也就是最终得到的图和原图一样，随着 <code>batch-size</code> 的增加这种情况出现的概率也会逐渐减小。</p>
<p>结果如 <strong>图12</strong> 所示。</p>
<p><img src="E:\笔记\markdown\reference\picture\test_mixup.png" alt="图12 Mixup后图像可视化"></p>
<center>图12 Mixup后图像可视化</center>

<h4 id="5-2-Cutmix"><a href="#5-2-Cutmix" class="headerlink" title="5.2 Cutmix"></a>5.2 <a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#cutmix">Cutmix</a></h4><p>论文地址：<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1905.04899v2.pdf">https://arxiv.org/pdf/1905.04899v2.pdf</a></p>
<p>开源代码github地址：<a target="_blank" rel="noopener" href="https://github.com/clovaai/CutMix-PyTorch">https://github.com/clovaai/CutMix-PyTorch</a></p>
<p>与 <code>Mixup</code> 直接对两幅图进行相加不一样，<code>Cutmix</code> 是从一幅图中随机裁剪出一个 <code>ROI</code>，然后覆盖当前图像中对应的区域。</p>
<p>结果如 <strong>图13</strong> 所示。</p>
<p><img src="E:\笔记\markdown\reference\picture\test_cutmix.png" alt="图13 Cutmix后图像可视化"></p>
<center>图13 Cutmix后图像可视化</center>

<h3 id="六、实验"><a href="#六、实验" class="headerlink" title="六、实验"></a>六、<a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#id6">实验</a></h3><p>基于PaddleClas套件，使用上述几种数据增广方法在ImageNet1k数据集上进行了实验测试，每个方法的分类精度如下。</p>
<table>
<thead>
<tr>
<th>模型</th>
<th>初始学习率策略</th>
<th>l2 decay</th>
<th>batch size</th>
<th>epoch</th>
<th>数据变化策略</th>
<th>Top1 Acc</th>
<th>论文中结论</th>
</tr>
</thead>
<tbody><tr>
<td>ResNet50</td>
<td>0.1/cosine_decay</td>
<td>0.0001</td>
<td>256</td>
<td>300</td>
<td>标准变换</td>
<td>0.7731</td>
<td>-</td>
</tr>
<tr>
<td>ResNet50</td>
<td>0.1/cosine_decay</td>
<td>0.0001</td>
<td>256</td>
<td>300</td>
<td>AutoAugment</td>
<td>0.7795</td>
<td>0.7763</td>
</tr>
<tr>
<td>ResNet50</td>
<td>0.1/cosine_decay</td>
<td>0.0001</td>
<td>256</td>
<td>300</td>
<td>mixup</td>
<td>0.7828</td>
<td>0.7790</td>
</tr>
<tr>
<td>ResNet50</td>
<td>0.1/cosine_decay</td>
<td>0.0001</td>
<td>256</td>
<td>300</td>
<td>cutmix</td>
<td>0.7839</td>
<td>0.7860</td>
</tr>
<tr>
<td>ResNet50</td>
<td>0.1/cosine_decay</td>
<td>0.0001</td>
<td>256</td>
<td>300</td>
<td>cutout</td>
<td>0.7801</td>
<td>-</td>
</tr>
<tr>
<td>ResNet50</td>
<td>0.1/cosine_decay</td>
<td>0.0001</td>
<td>256</td>
<td>300</td>
<td>gridmask</td>
<td>0.7785</td>
<td>0.7790</td>
</tr>
<tr>
<td>ResNet50</td>
<td>0.1/cosine_decay</td>
<td>0.0001</td>
<td>256</td>
<td>300</td>
<td>random-augment</td>
<td>0.7770</td>
<td>0.7760</td>
</tr>
<tr>
<td>ResNet50</td>
<td>0.1/cosine_decay</td>
<td>0.0001</td>
<td>256</td>
<td>300</td>
<td>random erasing</td>
<td>0.7791</td>
<td>-</td>
</tr>
<tr>
<td>ResNet50</td>
<td>0.1/cosine_decay</td>
<td>0.0001</td>
<td>256</td>
<td>300</td>
<td>hide and seek</td>
<td>0.7743</td>
<td>0.7720</td>
</tr>
</tbody></table>
<p><strong>注意</strong>：</p>
<ul>
<li>在实验中，为了便于对比，将l2 decay固定设置为1e-4，在实际使用中，推荐尝试使用更小的l2 decay。结合数据增广，发现将l2 decay由1e-4减小为7e-5均能带来至少0.3~0.5%的精度提升。</li>
<li>在使用数据增广后，由于训练数据更难，所以训练损失函数可能较大，训练集的准确率相对较低，但其拥有更好的泛化能力，所以验证集的准确率相对较高。</li>
<li>在使用数据增广后，模型可能会趋于欠拟合状态，建议可以适当的调小<code>l2_decay</code>的值来获得更高的验证集准确率。</li>
</ul>
<h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a><a target="_blank" rel="noopener" href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/image_augmentation/ImageAugment.html#id7">参考文献</a></h3><p>[1] <a target="_blank" rel="noopener" href="https://arxiv.org/abs/1805.09501v1">Autoaugment: Learning augmentation strategies from data</a></p>
<p>[2] <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1909.13719.pdf">Randaugment: Practical automated data augmentation with a reduced search space</a></p>
<p>[3] <a target="_blank" rel="noopener" href="https://arxiv.org/abs/1708.04552">Improved regularization of convolutional neural networks with cutout</a></p>
<p>[4] <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1708.04896.pdf">Random erasing data augmentation</a></p>
<p>[5] <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1811.02545.pdf">Hide-and-seek: Forcing a network to be meticulous for weakly-supervised object and action localization</a></p>
<p>[6] <a target="_blank" rel="noopener" href="https://arxiv.org/abs/2001.04086">GridMask Data Augmentation</a></p>
<p>[7] <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1710.09412.pdf">mixup: Beyond empirical risk minimization</a></p>
<p>[8] <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1905.04899v2.pdf">Cutmix: Regularization strategy to train strong classifiers with localizable features</a>)</p>
<h3 id="实验中用到的增强方法总结"><a href="#实验中用到的增强方法总结" class="headerlink" title="实验中用到的增强方法总结"></a>实验中用到的增强方法总结</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># transforms 类</span></span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Transforms</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        transform= [</span><br><span class="line">                transforms.RandomResizedCrop(size=args.image_size,scale=(<span class="number">0.2</span>, <span class="number">1.0</span>),ratio=(<span class="number">3</span> / <span class="number">4</span>, <span class="number">4</span> / <span class="number">3</span>)),</span><br><span class="line">                transforms.ColorJitter(brightness=<span class="number">0.4</span>, contrast=<span class="number">0.4</span>, saturation=<span class="number">0.4</span>),</span><br><span class="line">                transforms.RandomGrayscale(p=<span class="number">0.2</span>),</span><br><span class="line">                transforms.ToTensor(),</span><br><span class="line">                transforms.Normalize(mean=[<span class="number">0.4914</span>, <span class="number">0.4822</span>, <span class="number">0.4465</span>],std=[<span class="number">0.2470</span>, <span class="number">0.2435</span>, <span class="number">0.2616</span>])</span><br><span class="line">        ]</span><br><span class="line">        self.train_transform = transforms.Compose(transform)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.train_transform(x),self.train_transform(x)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 调用方法一</span></span><br><span class="line">dataset = CIFAR100(root=args.dataset_root,train=<span class="literal">False</span>,download=<span class="literal">True</span>,transform=Transforms())</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-特色包" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/04/07/%E7%89%B9%E8%89%B2%E5%8C%85/" class="article-date">
      <time datetime="2022-04-07T10:10:44.000Z" itemprop="datePublished">2022-04-07</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/07/%E7%89%B9%E8%89%B2%E5%8C%85/">特色包</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="控制台颜色"><a href="#控制台颜色" class="headerlink" title="控制台颜色"></a>控制台颜色</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> termcolor <span class="keyword">import</span> colored</span><br><span class="line"><span class="built_in">print</span>(colored(<span class="string">&#x27;Fill memory bank for mining the nearest neighbors (train) ...&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h1 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h1><blockquote>
<p>  This module defines functions and classes which implement a flexible event logging system for applications and libraries.</p>
<p>  Python logging 模块定义了为应用程序和库实现灵活的事件日志记录的函数和类。</p>
</blockquote>
<p>程序开发过程中，很多程序都有记录日志的需求，并且日志包含的信息有正常的程序访问日志还可能有错误、警告等信息输出，Python 的 logging 模块提供了标准的日志接口，可以通过它存储各种格式的日志,日志记录提供了一组便利功能，用于简单的日志记录用法。</p>
<ul>
<li>  使用 Python Logging 模块的主要好处是所有 Python 模块都可以参与日志记录</li>
<li>  Logging 模块提供了大量具有灵活性的功能</li>
</ul>
<p><strong>日志记录函数以它们用来跟踪的事件的级别或严重性命名。下面描述了标准级别及其适用性（从高到低的顺序）：</strong></p>
<table>
<thead>
<tr>
<th>日志等级(level)</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><strong>日志级别等级排序</strong>：critical &gt; error &gt; warning &gt; info &gt; debug</p>
<p><strong>级别越高打印的日志越少，反之亦然，即</strong></p>
<ul>
<li>  debug : 打印全部的日志( notset 等同于 debug )</li>
<li>  info : 打印 info, warning, error, critical 级别的日志</li>
<li>  warning : 打印 warning, error, critical 级别的日志</li>
<li>  error : 打印 error, critical 级别的日志</li>
<li>  critical : 打印 critical 级别</li>
</ul>
<h2 id="一、-Logging-模块日志记录方式"><a href="#一、-Logging-模块日志记录方式" class="headerlink" title="一、 Logging 模块日志记录方式"></a><strong>一、 Logging 模块日志记录方式</strong></h2><p>Logging 模块提供了两种日志记录方式：</p>
<ul>
<li>  一种方式是使用 Logging 提供的模块级别的函数</li>
<li>  另一种方式是使用 Logging 日志系统的四大组件记录</li>
</ul>
<h2 id="1、Logging-定义的模块级别函数"><a href="#1、Logging-定义的模块级别函数" class="headerlink" title="1、Logging 定义的模块级别函数"></a><strong>1、Logging 定义的模块级别函数</strong></h2><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
</table>
<p>简单打印日志：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印日志级别</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_logging</span>():</span></span><br><span class="line">    logging.debug(<span class="string">&#x27;Python debug&#x27;</span>)</span><br><span class="line">    logging.info(<span class="string">&#x27;Python info&#x27;</span>)</span><br><span class="line">    logging.warning(<span class="string">&#x27;Python warning&#x27;</span>)</span><br><span class="line">    logging.error(<span class="string">&#x27;Python Error&#x27;</span>)</span><br><span class="line">    logging.critical(<span class="string">&#x27;Python critical&#x27;</span>)</span><br><span class="line"></span><br><span class="line">test_logging()</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WARNING:root:Python warning</span><br><span class="line">ERROR:root:Python Error</span><br><span class="line">CRITICAL:root:Python critical</span><br></pre></td></tr></table></figure>

<p>当指定一个日志级别之后，会记录大于或等于这个日志级别的日志信息，小于的将会被丢弃， ==默认情况下日志打印只显示大于等于 WARNING 级别的日志。==</p>
<h3 id="1-1-设置日志显示级别"><a href="#1-1-设置日志显示级别" class="headerlink" title="1.1 设置日志显示级别"></a><strong>1.1 设置日志显示级别</strong></h3><p>通过 logging.basicConfig() 可以设置 root 的日志级别，和日志输出格式。</p>
<p><strong>logging.basicConfig() 关键字参数</strong>：</p>
<table>
<thead>
<tr>
<th>关键字</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><strong>format 格式</strong></p>
<table>
<thead>
<tr>
<th>格式</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><strong>注意</strong>：Logging.basicConfig() 需要在开头就设置，在中间设置并无作用</p>
<p><strong>实例</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line"># 打印日志级别</span><br><span class="line">def test():</span><br><span class="line">    logging.basicConfig(level=logging.DEBUG)</span><br><span class="line">    logging.debug(&#x27;Python debug&#x27;)</span><br><span class="line">    logging.info(&#x27;Python info&#x27;)</span><br><span class="line">    logging.warning(&#x27;Python warning&#x27;)</span><br><span class="line">    logging.error(&#x27;Python Error&#x27;)</span><br><span class="line">    logging.critical(&#x27;Python critical&#x27;)</span><br><span class="line">    logging.log(2,&#x27;test&#x27;)</span><br><span class="line">test()</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DEBUG:root:Python debug</span><br><span class="line">INFO:root:Python info</span><br><span class="line">WARNING:root:Python warning</span><br><span class="line">ERROR:root:Python Error</span><br><span class="line">CRITICAL:root:Python critical</span><br></pre></td></tr></table></figure>

<h3 id="1-2-将日志信息记录到文件"><a href="#1-2-将日志信息记录到文件" class="headerlink" title="1.2 将日志信息记录到文件"></a><strong>1.2 将日志信息记录到文件</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 日志信息记录到文件</span><br><span class="line">logging.basicConfig(filename=&#x27;F:/example.log&#x27;, level=logging.DEBUG)</span><br><span class="line">logging.debug(&#x27;This message should go to the log file&#x27;)</span><br><span class="line">logging.info(&#x27;So should this&#x27;)</span><br><span class="line">logging.warning(&#x27;And this, too&#x27;)</span><br></pre></td></tr></table></figure>

<p>在相应的路径下会有 example.log 日志文件，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DEBUG:root:This message should go to the log file</span><br><span class="line">INFO:root:So should this</span><br><span class="line">WARNING:root:And this, too</span><br></pre></td></tr></table></figure>

<h3 id="1-3-多个模块记录日志信息"><a href="#1-3-多个模块记录日志信息" class="headerlink" title="1.3 多个模块记录日志信息"></a><strong>1.3 多个模块记录日志信息</strong></h3><p>如果程序包含多个模块，则用以下实例来显示日志信息： 实例中有两个模块，一个模块通过导入另一个模块的方式用日志显示另一个模块的信息：</p>
<p><strong>myapp.py 模块</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line">import mylib</span><br><span class="line">def main():</span><br><span class="line">    logging.basicConfig(filename=&#x27;myapp.log&#x27;,level=logging.DEBUG)</span><br><span class="line">    logging.info(&#x27;Started&#x27;)</span><br><span class="line">    mylib.do_something()</span><br><span class="line">    logging.info(&#x27;Finished&#x27;)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p><strong>mylib.py 模块</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">def do_something():</span><br><span class="line">    logging.info(&#x27;Doing something&#x27;)</span><br></pre></td></tr></table></figure>

<p>执行 myapp.py 模块会打印相应日志，在文件 myapp.log 中显示信息如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INFO:root:Started</span><br><span class="line">INFO:root:Doing something</span><br><span class="line">INFO:root:Finishe</span><br></pre></td></tr></table></figure>

<h3 id="1-4-显示信息的日期及更改显示消息格式"><a href="#1-4-显示信息的日期及更改显示消息格式" class="headerlink" title="1.4 显示信息的日期及更改显示消息格式"></a><strong>1.4 显示信息的日期及更改显示消息格式</strong></h3><p><strong>显示消息日期</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"># 显示消息时间</span><br><span class="line">logging.basicConfig(format=&#x27;%(asctime)s %(message)s&#x27;)</span><br><span class="line">logging.warning(&#x27;is when this event was logged.&#x27;)</span><br><span class="line"></span><br><span class="line">logging.basicConfig(format=&#x27;%(asctime)s %(message)s&#x27;, datefmt=&#x27;%m/%d/%Y %I:%M:%S %p&#x27;)</span><br><span class="line">logging.warning(&#x27;is when this event was logged.&#x27;)</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2019-10-16 18:57:45,988 is when this event was logged.</span><br><span class="line">2019-10-16 18:57:45,988 is when this event was logged.</span><br></pre></td></tr></table></figure>

<p><strong>更改显示消息格式</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"># 更改显示消息的格式</span><br><span class="line">logging.basicConfig(format=&#x27;%(levelname)s:%(message)s&#x27;,level=logging.DEBUG)</span><br><span class="line">logging.debug(&#x27;Python message format Debug&#x27;)</span><br><span class="line">logging.info(&#x27;Python message format Info&#x27;)</span><br><span class="line">logging.warning(&#x27;Python message format Warning&#x27;)</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DEBUG:Python message format Debug</span><br><span class="line">INFO:Python message format Info</span><br><span class="line">WARNING:Python message format Warning</span><br></pre></td></tr></table></figure>

<p>==注意==：显示结果只显示级别和具体信息，之前显示的 “根” 已经消失，重新定义的格式修改了默认输出方式。</p>
<h2 id="2、logging-模块四大组件"><a href="#2、logging-模块四大组件" class="headerlink" title="2、logging 模块四大组件"></a><strong>2、logging 模块四大组件</strong></h2><table>
<thead>
<tr>
<th>组件名称</th>
<th>对应类名</th>
<th>功能描述</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-1-日志器-Logger"><a href="#2-1-日志器-Logger" class="headerlink" title="2.1 日志器- Logger"></a><strong>2.1 日志器- Logger</strong></h3><p>Logger 持有日志记录器的方法，日志记录器不直接实例化，而是通过模块级函数 logger.getlogger (name) 来实例化,使用相同的名称多次调用 getLogger() 总是会返回对相同 Logger 对象的引用。</p>
<ul>
<li>  应用程序代码能直接调用日志接口。</li>
<li>  Logger最常用的操作有两类：配置和发送日志消息。</li>
<li>  初始化 logger = logging.getLogger(“endlesscode”)，获取 logger 对象，getLogger() 方法后面最好加上所要日志记录的模块名字，配置文件和打印日志格式中的 %(name)s 对应的是这里的模块名字，如果不指定name则返回root对象。</li>
<li>  logger.setLevel(logging.DEBUG)，Logging 中有 NOTSET &lt; DEBUG &lt; INFO &lt; WARNING &lt; ERROR &lt; CRITICAL这几种级别，日志会记录设置级别以上的日志</li>
<li>  多次使用相同的name调用 getLogger 方法返回同一个 looger 对象；</li>
</ul>
<p>Logger是一个树形层级结构，在使用接口 debug，info，warn，error，critical 之前必须创建 Logger 实例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">创建方法: logger = logging.getLogger(logger_name)</span><br></pre></td></tr></table></figure>

<p>创建Logger实例后，可以使用以下方法进行日志级别设置，增加处理器 Handler：</p>
<ul>
<li>  logger.setLevel(logging.ERROR) # 设置日志级别为 ERROR，即只有日志级别大于等于 ERROR 的日志才会输出</li>
<li>  logger.addHandler(handler_name) # 为 Logger 实例增加一个处理器</li>
<li>  logger.removeHandler(handler_name) # 为 Logger 实例删除一个处理器</li>
</ul>
<h3 id="2-2-处理器-Handler"><a href="#2-2-处理器-Handler" class="headerlink" title="2.2 处理器- Handler"></a><strong>2.2 处理器- Handler</strong></h3><p>Handler 处理器类型有很多种，比较常用的有三个，StreamHandler，FileHandler，NullHandler</p>
<p><strong>StreamHandler</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">创建方法：sh = logging.StreamHandler(stream=None)</span><br></pre></td></tr></table></figure>

<p>创建 StreamHandler 之后，可以通过使用以下方法设置日志级别，设置格式化器 Formatter，增加或删除过滤器 Filter：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ch.setLevel(logging.WARN) # 指定日志级别，低于WARN级别的日志将被忽略</span><br><span class="line"></span><br><span class="line">ch.setFormatter(formatter_name) # 设置一个格式化器formatter</span><br><span class="line"></span><br><span class="line">ch.addFilter(filter_name) # 增加一个过滤器，可以增加多个</span><br><span class="line"> </span><br><span class="line">ch.removeFilter(filter_name) # 删除一个过滤器</span><br></pre></td></tr></table></figure>

<h3 id="2-3-过滤器-Filter"><a href="#2-3-过滤器-Filter" class="headerlink" title="2.3 过滤器- Filter"></a><strong>2.3 过滤器- Filter</strong></h3><p>Handlers 和 Loggers 可以使用 Filters 来完成比级别更复杂的过滤。 Filter 基类只允许特定 Logger 层次以下的事件。 例如用 ‘A.B’ 初始化的 Filter 允许Logger ‘A.B’, ‘A.B.C’, ‘A.B.C.D’, ‘A.B.D’ 等记录的事件，logger‘A.BB’, ‘B.A.B’ 等就不行。 如果用空字符串来初始化，所有的事件都接受。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">创建方法: filter = logging.Filter(name=&#x27;&#x27;)</span><br></pre></td></tr></table></figure>

<h3 id="2-4-格式器-Formatter"><a href="#2-4-格式器-Formatter" class="headerlink" title="2.4 格式器- Formatter"></a><strong>2.4 格式器- Formatter</strong></h3><p>使用Formatter对象设置日志信息最后的规则、结构和内容，默认的时间格式为%Y-%m-%d %H:%M:%S。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">创建方法: formatter = logging.Formatter(fmt=None, datefmt=None)</span><br></pre></td></tr></table></figure>

<p>其中，fmt 是消息的格式化字符串，datefmt 是日期字符串。如果不指明 fmt，将使用 ‘%(message)s’ 。如果不指明 datefmt，将使用 ISO8601 日期格式。</p>
<h3 id="2-5-组件之间的关联关系"><a href="#2-5-组件之间的关联关系" class="headerlink" title="2.5 组件之间的关联关系"></a><strong>2.5 组件之间的关联关系</strong></h3><ul>
<li>  日志器（logger）需要通过处理器（handler）将日志信息输出到目标位置，不同的处理器（handler）可以将日志输出到不同的位置；</li>
<li>  日志器（logger）可以设置多个处理器（handler）将同一条日志记录输出到不同的位置；</li>
<li>  每个处理器（handler）都可以设置自己的过滤器（filter）实现日志过滤，从而只保留感兴趣的日志；</li>
<li>  每个处理器（handler）都可以设置自己的格式器（formatter）实现同一条日志以不同的格式输出到不同的地方。</li>
</ul>
<p>简明了说就是：日志器（logger）是入口，真正干活儿的是处理器（handler），处理器（handler）还可以通过过滤器（filter）和格式器（formatter）对要输出的日志内容做过滤和格式化等处理操作。</p>
<ul>
<li>  Logger 可以包含一个或多个 Handler 和 Filter</li>
<li>  Logger 与 Handler 或 Fitler 是一对多的关系</li>
<li>  一个 Logger 实例可以新增多 个 Handler，一个 Handler 可以新增多个格式化器或多个过滤器，而且日志级别将会继承。</li>
</ul>
<h2 id="二、Logging-日志工作流程"><a href="#二、Logging-日志工作流程" class="headerlink" title="二、Logging 日志工作流程"></a><strong>二、Logging 日志工作流程</strong></h2><h2 id="1、Logging-模块使用过程"><a href="#1、Logging-模块使用过程" class="headerlink" title="1、Logging 模块使用过程"></a><strong>1、Logging 模块使用过程</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1）第一次导入 logging 模块或使用 reload 函数重新导入 logging 模块，logging 模块中的代码将被执行，这个过程中将产生 logging 日志系统的默认配置。</span><br><span class="line"></span><br><span class="line">2）自定义配置(可选),logging标准模块支持三种配置方式: dictConfig，fileConfig，listen。其中，dictConfig 是通过一个字典进行配置 Logger，Handler，Filter，Formatter；fileConfig 则是通过一个文件进行配置；而 listen 则监听一个网络端口，通过接收网络数据来进行配置。当然，除了以上集体化配置外，也可以直接调用 Logger，Handler 等对象中的方法在代码中来显式配置。</span><br><span class="line"></span><br><span class="line">3）使用 logging 模块的全局作用域中的 getLogger 函数来得到一个 Logger 对象实例(其参数即是一个字符串，表示 Logger 对象实例的名字，即通过该名字来得到相应的 Logger 对象实例)。</span><br><span class="line"></span><br><span class="line">4）使用 Logger 对象中的 debug，info，error，warn，critical 等方法记录日志信息。</span><br></pre></td></tr></table></figure>

<h2 id="2、Logging-模块处理流程"><a href="#2、Logging-模块处理流程" class="headerlink" title="2、Logging 模块处理流程"></a><strong>2、Logging 模块处理流程</strong></h2><p>流程描述：</p>
<ol>
<li> 判断日志的等级是否大于 Logger 对象的等级，如果大于，则往下执行，否则，流程结束。</li>
<li> 产生日志：第一步，判断是否有异常，如果有，则添加异常信息。 第二步，处理日志记录方法(如 debug，info 等)中的占位符，即一般的字符串格式化处理。</li>
<li> 使用注册到 Logger 对象中的 Filters 进行过滤。如果有多个过滤器，则依次过滤；只要有一个过滤器返回假，则过滤结束，且该日志信息将丢弃，不再处理，而处理流程也至此结束。否则，处理流程往下执行。</li>
<li> 在当前 Logger 对象中查找 Handlers，如果找不到任何 Handler，则往上到该 Logger 对象的父 Logger 中查找；如果找到一个或多个 Handler，则依次用 Handler 来处理日志信息。但在每个 Handler 处理日志信息过程中，会首先判断日志信息的等级是否大于该 Handler 的等级，如果大于，则往下执行(由 Logger 对象进入 Handler 对象中)，否则，处理流程结束。</li>
<li> 执行 Handler 对象中的 filter 方法，该方法会依次执行注册到该 Handler 对象中的 Filter。如果有一个 Filter 判断该日志信息为假，则此后的所有 Filter 都不再执行，而直接将该日志信息丢弃，处理流程结束。</li>
<li> 使用 Formatter 类格式化最终的输出结果。 注：Formatter 同上述第 2 步的字符串格式化不同，它会添加额外的信息，比如日志产生的时间，产生日志的源代码所在的源文件的路径等等。</li>
<li> 真正地输出日志信息(到网络，文件，终端，邮件等)。至于输出到哪个目的地，由 Handler 的种类来决定。</li>
</ol>
<h2 id="三、配置日志"><a href="#三、配置日志" class="headerlink" title="三、配置日志"></a><strong>三、配置日志</strong></h2><p>程序员可以通过三种方式配置日志记录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、使用配置方法的 Python 代码显式创建记录器，处理程序和格式化程序。</span><br><span class="line"></span><br><span class="line">2、创建日志记录配置文件并使用该 fileConfig() 功能读取它。</span><br><span class="line"></span><br><span class="line">3、创建配置信息字典并将其传递给 dictConfig()函数。</span><br></pre></td></tr></table></figure>

<p>下面使用 Python 代码配置一个非常简单的记录器，一个控制台处理程序和一个简单的格式化程序：</p>
<p><strong>logging.conf 配置文件</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[loggers]</span><br><span class="line">keys=root,simpleExample</span><br><span class="line"></span><br><span class="line">[handlers]</span><br><span class="line">keys=consoleHandler</span><br><span class="line"></span><br><span class="line">[formatters]</span><br><span class="line">keys=simpleFormatter</span><br><span class="line"></span><br><span class="line">[logger_root]</span><br><span class="line">level=DEBUG</span><br><span class="line">handlers=consoleHandler</span><br><span class="line"></span><br><span class="line">[logger_simpleExample]</span><br><span class="line">level=DEBUG</span><br><span class="line">handlers=consoleHandler</span><br><span class="line">qualname=simpleExample</span><br><span class="line">propagate=0</span><br><span class="line"></span><br><span class="line">[handler_consoleHandler]</span><br><span class="line">class=StreamHandler</span><br><span class="line">level=DEBUG</span><br><span class="line">formatter=simpleFormatter</span><br><span class="line">args=(sys.stdout,)</span><br><span class="line"></span><br><span class="line">[formatter_simpleFormatter]</span><br><span class="line">format=%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><br><span class="line">datefmt=</span><br></pre></td></tr></table></figure>

<p><strong>config_logging.py 配置器</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"># create logger</span><br><span class="line">logger = logging.getLogger(&#x27;simple_example&#x27;)</span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"># create console handler and set level to debug</span><br><span class="line">ch = logging.StreamHandler()</span><br><span class="line">ch.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"># create formatter</span><br><span class="line">formatter = logging.Formatter(&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;)</span><br><span class="line"></span><br><span class="line"># add formatter to ch</span><br><span class="line">ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line"># add ch to logger</span><br><span class="line">logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line"># &#x27;application&#x27; code</span><br><span class="line">logger.debug(&#x27;debug message&#x27;)</span><br><span class="line">logger.info(&#x27;info message&#x27;)</span><br><span class="line">logger.warning(&#x27;warn message&#x27;)</span><br><span class="line">logger.error(&#x27;error message&#x27;)</span><br><span class="line">logger.critical(&#x27;critical message&#x27;)</span><br></pre></td></tr></table></figure>

<p><strong>recorder 记录器</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line">import logging.config</span><br><span class="line"></span><br><span class="line">logging.config.fileConfig(&#x27;logging.conf&#x27;)</span><br><span class="line"></span><br><span class="line"># create logger</span><br><span class="line">logger = logging.getLogger(&#x27;simpleExample&#x27;)</span><br><span class="line"></span><br><span class="line"># &#x27;application&#x27; code</span><br><span class="line">logger.debug(&#x27;debug message&#x27;)</span><br><span class="line">logger.info(&#x27;info message&#x27;)</span><br><span class="line">logger.warning(&#x27;warn message&#x27;)</span><br><span class="line">logger.error(&#x27;error message&#x27;)</span><br><span class="line">logger.critical(&#x27;critical message&#x27;)</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2019-10-16 19:45:34,440 - simple_example - DEBUG - debug message</span><br><span class="line">2019-10-16 19:45:34,440 - simple_example - INFO - info message</span><br><span class="line">2019-10-16 19:45:34,440 - simple_example - WARNING - warn message</span><br><span class="line">2019-10-16 19:45:34,440 - simple_example - ERROR - error message</span><br><span class="line">2019-10-16 19:45:34,441 - simple_example - CRITICAL - critical message</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2><p>本章节给大家介绍了 Python 标准库中 Logging 模块的详细介绍与使用，对 Python 工程师使用该模块提供更好的支撑</p>
<p>参考： <a href="https://link.zhihu.com/?target=https://docs.python.org/3.6/library/logging.html?highlight=logging%23integration-with-the-warnings-module">https://docs.python.org/3.6/library/logging.html?highlight=logging#integration-with-the-warnings-module</a> <a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/feb86c06c4f4">https://www.jianshu.com/p/feb86c06c4f4</a><br><a href="https://link.zhihu.com/?target=https://cloud.tencent.com/developer/article/1354396">https://cloud.tencent.com/devel</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-python语法" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/04/07/python%E8%AF%AD%E6%B3%95/" class="article-date">
      <time datetime="2022-04-07T08:10:44.000Z" itemprop="datePublished">2022-04-07</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/07/python%E8%AF%AD%E6%B3%95/">python语法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h2 id="矩阵的操作"><a href="#矩阵的操作" class="headerlink" title="矩阵的操作"></a>矩阵的操作</h2><h3 id="view-和reshape"><a href="#view-和reshape" class="headerlink" title="view()和reshape"></a>view()和reshape</h3><p>view操作后的变量还是连续的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = torch.tensor([[[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]],</span><br><span class="line">                  [[<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>],[<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>]]</span><br><span class="line">                 ])</span><br><span class="line">b = a.view(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">b = tensor([[ <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>],</span><br><span class="line">        [<span class="number">5</span>,  <span class="number">6</span> ,<span class="number">7</span>,	<span class="number">8</span>],</span><br><span class="line">        [<span class="number">9</span>,	<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]])</span><br></pre></td></tr></table></figure>

<p>张量a的size是2x2x3，使用view函数后，先将这12个元素排成一列，然后将其依次填充至新的4x3的张量中：</p>
<p><img src="E:\笔记\markdown\reference\picture\v2-acfb79d45817e3080ddcac7666d61f09_b.jpg" alt="img"></p>
<p>为了更细致，我们需要描述一下它们的具体操作流程（这并不是源码的流程，只是为了便于理解、记忆），因为二维比较直观，如果维度比较高的话，可能还是不够直观，心里老是有疑虑，还是以上面例子为例，张量a的每一个元素都有一个index，例如1的index是(0,0,0)，7的index是(1,0,0)，11的index是(1,1,1)……在拉成列向量排列时，排列规则是这样的，以(0,0,0)开始，维度从最后一维循环到第一维，在每一维内以升序将所有元素排成一列，即：</p>
<p><img src="E:\笔记\markdown\reference\picture\v2-0c59291b64850293305ab879087ea32d_b.jpg" alt="img"></p>
<p>然后依据新的size对每个元素给予新的index，仍然是维度从最后一维循环到第一维，在每一维内升序，即:</p>
<p><img src="E:\笔记\markdown\reference\picture\v2-ab9112d1c2f5bb21d1b3d164bffa5e95_b.jpg" alt="img"></p>
<blockquote>
<p>  torch的view()与reshape()方法都可以用来重塑tensor的shape，区别就是使用的条件不一样。view()方法只适用于满足连续性条件的tensor，并且该操作不会开辟新的内存空间，只是产生了对原存储空间的一个新别称和引用，返回值是视图。而reshape()方法的返回值既可以是视图，也可以是副本，当满足连续性条件时返回view，否则返回副本[ 此时等价于先调用contiguous()方法在使用view() ]。因此当不确能否使用view时，可以使用reshape。如果只是想简单地重塑一个tensor的shape，那么就是用reshape，但是如果需要考虑内存的开销而且要确保重塑后的tensor与之前的tensor共享存储空间，那就使用view()。</p>
</blockquote>
<h3 id="permute-和transpose"><a href="#permute-和transpose" class="headerlink" title="permute()和transpose()"></a>permute()和transpose()</h3><p>transpose()也是转置操作，与permute不同的是，transpose()每次只能进行二维转置，而permute()每次可转置多个维度().</p>
<p>接下来，说一下permute()，函数的参数为新的维度顺序，例如想交换第一维与第三维的index，则<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=tensor.permute&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:%2288311093%22%7D">tensor.permute</a>(2,1,0)，同样举一个简单第二维与第三维的例子，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = torch.tensor([[[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]],[[<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>],[<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>]]])</span><br><span class="line">b = a.permute(<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">b = tensor([[[ <span class="number">1</span>,  <span class="number">4</span>],</span><br><span class="line">         [ <span class="number">2</span>,  <span class="number">5</span>],</span><br><span class="line">         [ <span class="number">3</span>,  <span class="number">6</span>]],</span><br><span class="line">        [[ <span class="number">7</span>, <span class="number">10</span>],</span><br><span class="line">         [ <span class="number">8</span>, <span class="number">11</span>],</span><br><span class="line">         [ <span class="number">9</span>, <span class="number">12</span>]]])</span><br></pre></td></tr></table></figure>

<p><img src="E:\笔记\markdown\reference\picture\v2-6bdd87e65b64534339d3efad9ae4eae5_b.jpg" alt="img"></p>
<p>当维度比较大，交换维度的结果并不直观，我们还是说下permute到底做了什么，示意图如下。</p>
<p>需要说明一下，这里面的流程其实就是更改每个元素的index而已，上述例子中只是交换坐标，</p>
<p><img src="E:\笔记\markdown\reference\picture\v2-ec4167d8c19713e232ab3f5ba35ed10d_b.jpg" alt="img"></p>
<p>然后按照新的index更改下各元素的位置并展示出即可。</p>
<h3 id="squeeze-和unsqueeze-函数功能"><a href="#squeeze-和unsqueeze-函数功能" class="headerlink" title="squeeze()和unsqueeze()函数功能"></a>squeeze()和unsqueeze()函数功能</h3><h4 id="1-squeeze-dim-："><a href="#1-squeeze-dim-：" class="headerlink" title="1.squeeze(dim)："></a>1.squeeze(dim)：</h4><p>给张量tensor降维，但不是啥张量都可以用这两个函数来降维。dim指定需要降维的维度，这个维度的值必须为1才能被降维。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">a=torch.rand(<span class="number">2</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(a.shape)</span><br><span class="line"><span class="built_in">print</span>(a.squeeze(<span class="number">1</span>).shape)</span><br><span class="line"></span><br><span class="line"><span class="comment">#torch.Size([2, 1, 4, 1])</span></span><br><span class="line"><span class="comment">#torch.Size([2, 4, 1])</span></span><br></pre></td></tr></table></figure>

<p>2.unsqueeze(dim)</p>
<p>与squeeze(dim)相反，在dim维度上添加一个维度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">a=torch.rand(<span class="number">2</span>,<span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(a.shape)</span><br><span class="line"><span class="built_in">print</span>(a.unsqueeze(<span class="number">1</span>).shape)</span><br><span class="line"></span><br><span class="line"><span class="comment">#torch.Size([2, 4])</span></span><br><span class="line"><span class="comment">#torch.Size([2, 1, 4])</span></span><br></pre></td></tr></table></figure>





<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><p>在 Python 中，* 和 ** 具有语法多义性，具体来说是有四类用法。</p>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2022/04/07/python%E8%AF%AD%E6%B3%95/#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-聚类方法总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/04/07/%E8%81%9A%E7%B1%BB%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/" class="article-date">
      <time datetime="2022-04-07T08:10:44.000Z" itemprop="datePublished">2022-04-07</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/07/%E8%81%9A%E7%B1%BB%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/">聚类</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>可以使用模块 <a target="_blank" rel="noopener" href="http://scikit-learn.org.cn/lists/3.html#sklearn.cluster%EF%BC%9A%E8%81%9A%E7%B1%BB"><code>sklearn.cluster</code></a> 对未标记的数据进行 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cluster_analysis">聚类(Clustering)</a> 。</p>
<p>每个聚类算法都有两个变体:一个是类，它实现了 <code>fit</code> 方法来学习训练数据上的簇，另一个是函数，给定训练数据，返回对应于不同簇的整数标签数组。对于类，可以在 <code>labels_</code> 属性中找到训练数据上的标签。</p>
<blockquote>
<p>  <strong>输入数据</strong></p>
<p>  特别需要注意的一点是，本模块实现的算法可以采用不同类型的矩阵作为输入。所有算法的调用接口都接受 shape<code>[n_samples, n_features]</code> 的标准数据矩阵。 这些矩阵可以通过使用 <a target="_blank" rel="noopener" href="http://scikit-learn.org.cn/lists/3.html#sklearn.feature_extraction%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96"><code>sklearn.feature_extraction</code></a> 模块中的类获得。对于 <a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/370.html"><code>AffinityPropagation</code></a>, <a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/391.html"><code>SpectralClustering</code></a> 和 <a target="_blank" rel="noopener" href="https://scikit-learn.org.cn/view/379.html"><code>DBSCAN</code></a> 也可以输入 shape <code>[n_samples, n_samples]</code> 的相似矩阵，可以通过 <a target="_blank" rel="noopener" href="http://scikit-learn.org.cn/lists/3.html#sklearn.metrics%EF%BC%9A%E6%8C%87%E6%A0%87"><code>sklearn.metrics.pairwise</code></a> 模块中的函数获得。</p>
</blockquote>
<h3 id="聚类方法概述"><a href="#聚类方法概述" class="headerlink" title="聚类方法概述"></a>聚类方法概述</h3>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-pytorch使用汇总" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/04/07/pytorch%E4%BD%BF%E7%94%A8%E6%B1%87%E6%80%BB/" class="article-date">
      <time datetime="2022-04-07T04:44:13.000Z" itemprop="datePublished">2022-04-07</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/07/pytorch%E4%BD%BF%E7%94%A8%E6%B1%87%E6%80%BB/">pytorch使用汇总</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h2 id="日志输出"><a href="#日志输出" class="headerlink" title="日志输出"></a>日志输出</h2><p>利用logging模块在控制台实时打印并及时记录运行日志。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from config import  *</span><br><span class="line">import logging  # 引入logging模块</span><br><span class="line">import os.path</span><br><span class="line">class Logger:</span><br><span class="line">    def __init__(self,mode=&#x27;w&#x27;):</span><br><span class="line">        # 第一步，创建一个logger</span><br><span class="line">        self.logger = logging.getLogger()</span><br><span class="line">        self.logger.setLevel(logging.INFO)  # Log等级总开关</span><br><span class="line">        # 第二步，创建一个handler，用于写入日志文件</span><br><span class="line">        rq = time.strftime(&#x27;%Y%m%d%H%M&#x27;, time.localtime(time.time()))</span><br><span class="line">        log_path = os.getcwd() + &#x27;/Logs/&#x27;</span><br><span class="line">        log_name = log_path + rq + &#x27;.log&#x27;</span><br><span class="line">        logfile = log_name</span><br><span class="line">        fh = logging.FileHandler(logfile, mode=mode)</span><br><span class="line">        fh.setLevel(logging.DEBUG)  # 输出到file的log等级的开关</span><br><span class="line">        # 第三步，定义handler的输出格式</span><br><span class="line">        formatter = logging.Formatter(&quot;%(asctime)s - %(filename)s[line:%(lineno)d] - %(levelname)s: %(message)s&quot;)</span><br><span class="line">        fh.setFormatter(formatter)</span><br><span class="line">        # 第四步，将logger添加到handler里面</span><br><span class="line">        self.logger.addHandler(fh)</span><br><span class="line">        ch = logging.StreamHandler()</span><br><span class="line">        ch.setLevel(logging.INFO)  # 输出到console的log等级的开关</span><br><span class="line">        ch.setFormatter(formatter)</span><br><span class="line">        self.logger.addHandler(ch)</span><br></pre></td></tr></table></figure>



<h2 id="模型的保存和读取"><a href="#模型的保存和读取" class="headerlink" title="模型的保存和读取"></a>模型的保存和读取</h2><p>​    </p>
<table>
<thead>
<tr>
<th>保存</th>
<th align="left">（1）torch.save(net.state_dict(),保存路径) 。（2）多卡训练时，要用 torch.save(net.module.state_dict(),’./model/best.pth’)</th>
</tr>
</thead>
<tbody><tr>
<td>读取</td>
<td align="left">（1）net.load_state_dict(torch.load(‘best.pth’))。（2）并行时map_location=device.type在读取模型的时候一定要加上。即：    model.load_state_dict(torch.load(‘model/self_train_bestv2.pth’,map_location=’cuda’))</td>
</tr>
<tr>
<td></td>
<td align="left">torch.save(model.state_dict(),’checkpoint_0.tar’,_use_new_zipfile_serialization=False) #解决版本不兼容</td>
</tr>
</tbody></table>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pytorch/" rel="tag">pytorch</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2022/04/07/pytorch%E4%BD%BF%E7%94%A8%E6%B1%87%E6%80%BB/#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-深度学习 tricks" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/04/06/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%20tricks/" class="article-date">
      <time datetime="2022-04-06T15:06:13.000Z" itemprop="datePublished">2022-04-06</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/06/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%20tricks/">深度学习训练tricks</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h1 id="深度神经网络模型训练中的-tricks（原理与代码汇总）"><a href="#深度神经网络模型训练中的-tricks（原理与代码汇总）" class="headerlink" title="深度神经网络模型训练中的 tricks（原理与代码汇总）"></a>深度神经网络模型训练中的 tricks（原理与代码汇总）</h1><p>本文总结了多种<strong>图像分类</strong>任务中的重要技巧，对于<strong>目标检测和图像分割</strong>等任务，也起到了不错的作用。</p>
<p>计算机视觉主要问题有图像分类、目标检测和图像分割等。针对图像分类任务，提升准确率的方法路线有两条，一个是模型的修改，另一个是各种数据处理和训练的技巧(tricks)。图像分类中的各种技巧对于目标检测、图像分割等任务也有很好的作用，因此值得好好总结。本文在精读论文的基础上，总结了图像分类任务的各种tricks如下：</p>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag">深度学习</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2022/04/06/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%20tricks/#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-pytorch计算图" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/04/06/pytorch%E8%AE%A1%E7%AE%97%E5%9B%BE/" class="article-date">
      <time datetime="2022-04-05T16:08:00.000Z" itemprop="datePublished">2022-04-06</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/06/pytorch%E8%AE%A1%E7%AE%97%E5%9B%BE/">Understanding Graphs, Automatic Differentiation and Autograd</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <div align=center>

<p><img src="https://jpccc.github.io/resource/pytorch/full_graph.png" alt="img"></p>
</div>

<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>PyTorch is one of the foremost python deep learning libraries out there. It’s the go to choice for deep learning research, and as each days passes by, more and more companies and research labs are adopting this library.</p>
<p>In this series of tutorials, we will be introducing you to PyTorch, and how to make the best use of the libraries as well the ecosystem of tools built around it. We’ll first cover the basic building blocks, and then move onto how you can quickly prototype custom architectures. We will finally conclude with a couple of posts on how to scale your code, and how to debug your code if things go awry.</p>
<p>This is Part 1 of our PyTorch 101 series.</p>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pytorch/" rel="tag">pytorch</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2022/04/06/pytorch%E8%AE%A1%E7%AE%97%E5%9B%BE/#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Jensen-inequality" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/10/28/Jensen-inequality/" class="article-date">
      <time datetime="2021-10-28T08:10:44.000Z" itemprop="datePublished">2021-10-28</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/10/28/Jensen-inequality/">Jensen_inequality</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h1 id="Jensen不等式"><a href="#Jensen不等式" class="headerlink" title="Jensen不等式"></a>Jensen不等式</h1><p>Jensen不等式（Jensen’s inequality）是以丹麦数学家Johan Jensen命名的，它在概率论、机器学习、测度论、统计物理等领域都有相关应用。 在机器学习领域，我目前接触到的是用Jensen不等式用来证明KL散度大于等于0。</p>
<blockquote>
<p>Jensen不等式是和凸函数的定义是息息相关的，首先介绍什么是凸函数(convec function)。</p>
</blockquote>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/math/" rel="tag">math</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2021/10/28/Jensen-inequality/#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-统计学习part1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/10/28/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0part1/" class="article-date">
      <time datetime="2021-10-28T04:44:13.000Z" itemprop="datePublished">2021-10-28</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/10/28/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0part1/">统计学习数学基础-1</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>对概率的诠释有两大学派，一种是频率派另一种是贝叶斯派。后面我们对观测集采用下面记号：<br>$$<br>X_{N\times p}=(x_{1},x_{2},\cdots,x_{N})^{T},x_{i}=(x_{i1},x_{i2},\cdots,x_{ip})^{T}<br>$$<br>这个记号表示有 $N$ 个样本，每个样本都是 $p$ 维向量。其中每个观测都是由 $p(x|\theta)$ 生成的。</p>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0/" rel="tag">统计学习</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2021/10/28/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0part1/#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-深度学习/BN算法" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/10/25/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/BN%E7%AE%97%E6%B3%95/" class="article-date">
      <time datetime="2021-10-25T12:20:14.000Z" itemprop="datePublished">2021-10-25</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/10/25/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/BN%E7%AE%97%E6%B3%95/">BN算法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h1 id="BN算法"><a href="#BN算法" class="headerlink" title="BN算法"></a>BN算法</h1><h2 id="BN算法概要"><a href="#BN算法概要" class="headerlink" title="BN算法概要"></a>BN算法概要</h2><p>传统的神经网络，只是在将样本x输入到输入层之前对x进行标准化处理，以降低样本间的差异性。BN是在此基础上，不仅仅只对输入层的输入数据x进行标准化，还对每个隐藏层的输入进行标准化。</p>
<p>Batch Normalization是2015年一篇论文中提出的数据归一化方法，<strong>往往用在深度神经网络中激活层之前</strong>。其作用可以加快模型训练时的收敛速度，使得模型训练过程更加稳定，避免梯度爆炸或者梯度消失。（怎么避免梯度爆炸或梯度消失的？）</p>
<p>那为什么需要对每个隐藏层的输入进行标准化呢？或者说这样做有什么好处呢？这就牵涉到一个Covariate Shift问题。</p>
<p>并且起到一定的正则化作用，几乎代替了Dropout。</p>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/deepLearning/" rel="tag">deepLearning</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2021/10/25/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/BN%E7%AE%97%E6%B3%95/#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2021-2022  liusha
            </div>
            <div class="footer-right">
                回首向来萧瑟处，归去，也无风雨也无晴。
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_uv">
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>